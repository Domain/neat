module destructor;

macro import cx.macros.assert;

struct S
{
    int* ip;
    ~this()
    {
        *ip += 1;
    }
}

void test1()
{
    int i = 0;
    { S s = S(&i); }
    assert(i == 1);
    if (true) S s = S(&i);
    assert(i == 2);
    bool called;
    bool once() { if (!called) { called = true; return true; } return false; }
    while (once()) S s = S(&i);
    assert(i == 3);
    void test2() S s = S(&i);
    test2();
    assert(i == 4);
}

void main()
{
    test1();
}
