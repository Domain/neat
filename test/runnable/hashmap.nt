module hashmap;

macro import neat.macros.assert;

void main() {
    mut int[string] map;

    map["foo"] = 5;
    map["bar"] = 6;
    map["foo"] = 7;

    assert(map["foo"] == 7);
    assert(map["bar"] == 6);

    assert(map.has("bar"));
    assert(!map.has("baz"));

    {
        mut int calls;
        int deflt() { calls += 1; return 7; }
        assert(map.get("bar", deflt) == 6);
        assert(calls == 0);
        assert(map.get("baz", deflt) == 7);
        assert(calls == 1);
    }
}
