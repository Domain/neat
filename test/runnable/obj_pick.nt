module obj_pick;

macro import neat.macros.assert;

class Foo {
    Bar bar() { return new Bar; }
    this() { }
}

class Bar {
    this() { }
}

nullable Foo foo(bool test) { if (test) return new Foo; else return null; }

nullable Bar bar(bool test, (:type | :auto_) mode) {
    mode.case {
        (:type): {
            Foo foo <- foo(test);
            assert(!!foo);
            return foo.bar;
        }
        (:auto_): {
            auto foo <- foo(test);
            assert(!!foo);
            return foo.bar;
        }
    }
}

void main() {
    assert(!!bar(true, :type));
    assert(!!bar(true, :auto_));
    assert(!bar(false, :type));
    assert(!bar(false, :auto_));
}
