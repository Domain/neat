module std.math;

macro import neat.macros.assert;

alias pi = 3.1415926538;
alias PI = pi;
alias Ï€ = pi;

pragma(lib, "m");

extern(C) float sinf(float);
extern(C) double sin(double d);
float sin(float f) { return sinf(f); }

extern(C) float cosf(float);
extern(C) double cos(double);
float cos(float f) { return cosf(f); }

extern(C) float acosf(float f);
extern(C) double acos(double d);
float acos(float f) { return acosf(f); }

extern(C) float tanf(float f);
extern(C) double tan(double d);
float tan(float f) { return tanf(f); }

extern(C) float fabsf(float f);
extern(C) double fabs(double d);
double abs(double d) { return fabs(d); }
float abs(float f) { return fabsf(f); }
int abs(int i) { if (i < 0) return -i; return i; }

extern(C) float expf(float f);
extern(C) double exp(double d);
float exp(float f) { return expf(f); }

extern(C) float powf(float, float);
extern(C) double pow(double, double);
float pow(float x, float y) { return powf(x, y); }

// extern(C) float atan2f(float y, float x);
// float atan2(float y, float x) { return atan2f(y, x); }
// see http://dspguru.com/dsp/tricks/fixed-point-atan2-with-self-normalization/ thanks SO
float atan2(float y, float x) {
   float coeff_1 = 3.1415926537f;
   float coeff_2 = 3*coeff_1;
   float abs_y = fabsf(y)+0.000001f;
   mut float angle;
   if (x >= 0) {
      float r = (x - abs_y) / (x + abs_y);
      angle = coeff_1 - coeff_1 * r;
   } else {
      float r = (x + abs_y) / (abs_y - x);
      angle = coeff_2 - coeff_1 * r;
   }
   if (y < 0) return -angle;
   else return angle;
}

extern(C) float sqrtf(float);
extern(C) double sqrt(double d);
float sqrt(float f) { return sqrtf(f); }

int max(int a, int b) { if (a > b) return a; return b; }
float max(float a, float b) { if (a > b) return a; return b; }
double max(double a, double b) { if (a > b) return a; return b; }

unittest {
    assert(max(2, 3) == 3);
    assert(max(-4.5, -5) == -4.5);
}

int min(int a, int b) { if (a < b) return a; return b; }
size_t min(size_t a, size_t b) { if (a < b) return a; return b; }
float min(float a, float b) { if (a < b) return a; return b; }
double min(double a, double b) { if (a < b) return a; return b; }

unittest {
    assert(min(2, 3) == 2);
    assert(min(-4.5, -5) == -5);
}
